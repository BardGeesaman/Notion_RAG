[pytest]
# Test discovery
testpaths = tests amprenta_rag/tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
pythonpath = .

# Output options
addopts = 
    -v
    --tb=short
    --strict-markers
    --color=yes

# Warning handling - fail on our code's warnings, ignore third-party
filterwarnings =
    error::DeprecationWarning:amprenta_rag.*
    error::FutureWarning:amprenta_rag.*
    error::UserWarning:amprenta_rag.*
    # Allow third-party warnings we cannot control
    ignore::DeprecationWarning:sqlalchemy.*
    ignore::DeprecationWarning:pydantic.*
    ignore::DeprecationWarning:pandas.*
    ignore::DeprecationWarning:numpy.*
    ignore::FutureWarning:pandas.*
    ignore::UserWarning:pydantic.*
    ignore::PendingDeprecationWarning
    # Scipy: Precision loss in statistical functions (internal implementation detail)
    ignore::RuntimeWarning:scipy
    # nbconvert: Bleach deprecation in HTML sanitization (external dependency issue)
    ignore::DeprecationWarning:nbconvert
    # BoTorch: Custom warning classes (InputDataWarning, NumericsWarning) - catch all from botorch module
    ignore::Warning:botorch
    # Alembic: path_separator config option (legacy splitting behavior) - catch from any alembic submodule
    ignore::DeprecationWarning:alembic.*

# Test markers
markers =
    unit: Unit tests (fast, isolated)
    integration: Integration tests (require external services)
    slow: Slow tests that take >1 second
    requires_postgres: Tests requiring Postgres database
    requires_notion: Tests requiring Notion API
    ui: Tests for UI/dashboard flows (Streamlit/Playwright)
    requires_server: Tests that require running dashboard server at localhost:8502

[coverage:run]
source = amprenta_rag
omit = 
    amprenta_rag/tests/*
    */migrations/*
    */alembic/*

[coverage:report]
exclude_lines =
    pragma: no cover
    if TYPE_CHECKING:
    @abstractmethod

# Test timeout (if pytest-timeout is installed)
# timeout = 300
# timeout_method = thread

