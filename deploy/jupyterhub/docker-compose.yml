version: "3.9"

services:
  jupyterhub:
    build:
      context: ../..
      dockerfile: deploy/jupyterhub/Dockerfile
    container_name: amprenta-jupyterhub

    # Requirement: JupyterHub exposed on :8888 and able to reach FastAPI at localhost:8000.
    # Using host networking makes "localhost:8000" resolve to the host's FastAPI.
    network_mode: "host"

    environment:
      - API_URL=${API_URL:-http://localhost:8000}

    volumes:
      # Persist hub db/config and runtime files
      - jupyterhub-state:/srv/jupyterhub
      # Persist user notebooks/home directories
      - jupyterhub-users:/home

    restart: unless-stopped

volumes:
  jupyterhub-state:
  jupyterhub-users:


